generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       Int      @map("user_id")
  expires      DateTime
  account      Account  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model Account {
  id                    Int            @id @default(autoincrement())
  username              String?        @unique
  email                 String         @unique
  password              String?
  role                  Int?
  created_at            DateTime       @default(now())
  updated_at            DateTime       @updatedAt
  emailVerified         DateTime?
  provider              String?
  providerAccountId     String?
  backgroundUrl         String?
  logoUrl               String?
  accountRole           AccountRole?   @relation(fields: [role], references: [id])
  company               Company?
  documents             Document[]
  receivedNotifications Notification[] @relation("NotificationReceiver")
  sentNotifications     Notification[] @relation("NotificationSender")
  reports               Report[]
  student               Student?       @relation("StudentAccount")
  verifiedStudents      Student[]      @relation("VerifiedStudents")
  verifiedCompanies     Company[]      @relation("VerifiedCompanies")
  sessions              Session[]

  @@unique([provider, providerAccountId])
  @@index([email])
  @@index([role])
}

model AccountRole {
  id       Int       @id @default(autoincrement())
  name     String
  accounts Account[]
}

model Application {
  id                 Int               @id @default(autoincrement())
  job_post_id        Int
  student_id         Int
  status             Int
  applied_at         DateTime          @default(now())
  updated_at         DateTime          @updatedAt
  portfolio_id       Int?
  resume_id          Int?
  cv_id              Int?
  transcript_id      Int?
  jobPost            JobPost           @relation(fields: [job_post_id], references: [id], onDelete: Cascade)
  portfolioDocument  Document?         @relation("PortfolioDocument", fields: [portfolio_id], references: [id])
  resumeDocument     Document?         @relation("ResumeDocument", fields: [resume_id], references: [id])
  cvDocument         Document?         @relation("CvDocument", fields: [cv_id], references: [id])
  transcriptDocument Document?         @relation("TranscriptDocument", fields: [transcript_id], references: [id])
  applicationStatus  ApplicationStatus @relation(fields: [status], references: [id])
  student            Student           @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@unique([student_id, job_post_id])
  @@index([job_post_id])
  @@index([student_id])
}

model ApplicationStatus {
  id           Int           @id @default(autoincrement())
  name         String
  applications Application[]
}

model Company {
  id                  Int       @id @default(autoincrement())
  account_id          Int       @unique
  name                String
  address             String
  phone               String
  description         String
  register_day        DateTime
  registration_status String
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  website             String?
  verification_notes  String?
  verified_at         DateTime?
  verified_by         Int?
  account             Account   @relation(fields: [account_id], references: [id], onDelete: Cascade)
  verifiedByAdmin     Account?  @relation("VerifiedCompanies", fields: [verified_by], references: [id])
  jobPosts            JobPost[]

  @@index([registration_status])
}

model Document {
  id                    Int           @id @default(autoincrement())
  account_id            Int
  doc_type_id           Int
  file_path             String
  created_at            DateTime      @default(now())
  file_name             String
  portfolioApplications Application[] @relation("PortfolioDocument")
  resumeApplications    Application[] @relation("ResumeDocument")
  account               Account       @relation(fields: [account_id], references: [id], onDelete: Cascade)
  documentType          DocumentType  @relation(fields: [doc_type_id], references: [id])
  applications          Application[]
  applications          Application[]
}

model DocumentType {
  id        Int        @id @default(autoincrement())
  name      String
  documents Document[]
}

model JobArrangement {
  id    Int       @id @default(autoincrement())
  name  String    @unique
  posts JobPost[]
}

model JobCategory {
  id    Int       @id @default(autoincrement())
  name  String    @unique
  posts JobPost[]
}

model JobPost {
  id                 Int            @id @default(autoincrement())
  company_id         Int
  jobName            String
  location           String
  aboutRole          String
  requirements       String[]
  qualifications     String[]
  min_salary         Int
  max_salary         Int
  deadline           DateTime
  created_at         DateTime       @default(now())
  updated_at         DateTime
  is_Published       Boolean        @default(true)
  job_arrangement_id Int
  job_type_id        Int
  job_category_id    Int?
  responsibilities   String?
  applications       Application[]
  company            Company        @relation(fields: [company_id], references: [id], onDelete: Cascade)
  jobArrangement     JobArrangement @relation(fields: [job_arrangement_id], references: [id])
  category           JobCategory?   @relation(fields: [job_category_id], references: [id])
  jobType            JobType        @relation(fields: [job_type_id], references: [id])
  savedBy            SavedJob[]
  tags               JobTag[]       @relation("JobTagesOnPosts")
}

model JobTag {
  id    Int       @id @default(autoincrement())
  name  String
  posts JobPost[] @relation("JobTagesOnPosts")
}

model JobType {
  id    Int       @id @default(autoincrement())
  name  String    @unique
  posts JobPost[]
}

model Notification {
  id         Int      @id @default(autoincrement())
  account_id Int
  sender_id  Int?
  message    String
  is_read    Boolean  @default(false)
  created_at DateTime @default(now())
  account    Account  @relation("NotificationReceiver", fields: [account_id], references: [id], onDelete: Cascade)
  sender     Account? @relation("NotificationSender", fields: [sender_id], references: [id])

  @@index([account_id, sender_id, is_read])
}

model Report {
  id         Int      @id @default(autoincrement())
  account_id Int
  report_id  Int
  post_id    Int
  type       String
  created_at DateTime @default(now())
  account    Account  @relation(fields: [account_id], references: [id])
}

model SavedJob {
  id          Int      @id @default(autoincrement())
  student_id  Int
  job_post_id Int
  created_at  DateTime @default(now())
  jobPost     JobPost  @relation(fields: [job_post_id], references: [id], onDelete: Cascade)
  student     Student  @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@unique([student_id, job_post_id])
  @@index([job_post_id])
  @@index([student_id])
}

model Student {
  id                  Int                @id @default(autoincrement())
  account_id          Int                @unique
  student_id          String
  name                String
  faculty             String
  year                String
  phone               String
  created_at          DateTime           @default(now())
  updated_at          DateTime           @updatedAt
  transcript          String?
  email_verified      Boolean            @default(true)
  student_status      StudentStatus      @default(CURRENT)
  verification_notes  String?
  verification_status VerificationStatus @default(APPROVED)
  verified_at         DateTime?
  verified_by         Int?
  applications        Application[]
  savedJobs           SavedJob[]
  account             Account            @relation("StudentAccount", fields: [account_id], references: [id], onDelete: Cascade)
  verifiedByAdmin     Account?           @relation("VerifiedStudents", fields: [verified_by], references: [id])

  @@index([account_id])
  @@index([student_status])
  @@index([verification_status])
}

model email_verification_tokens {
  id         Int      @id @default(autoincrement())
  email      String
  token      String   @unique
  expires    DateTime
  created_at DateTime @default(now())

  @@index([email])
  @@index([token])
  @@map("email_verification_tokens")
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum StudentStatus {
  CURRENT
  ALUMNI
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
}
